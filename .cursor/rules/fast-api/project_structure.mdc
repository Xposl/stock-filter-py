---
description: 
globs: 
alwaysApply: true
---
# FastAPI é¡¹ç›®ç»“æ„è§„èŒƒ

## æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº† InvestNote-py FastAPI é¡¹ç›®çš„å®é™…ç›®å½•ç»“æ„ï¼ŒåŸºäºæŠ•èµ„ç¬”è®°ä¸åˆ†æç³»ç»Ÿçš„ä¸šåŠ¡éœ€æ±‚ï¼ŒåŒ…å«æ–°é—»èšåˆã€AIåˆ†æã€é‡åŒ–æŒ‡æ ‡ç­‰æ¨¡å—ã€‚

## InvestNote-py å®é™…ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ main.py                           # é¡¹ç›®ä¸»å…¥å£ï¼ŒæœåŠ¡å™¨å¯åŠ¨é…ç½®
â”œâ”€â”€ api/                             # API å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api.py                       # FastAPI åº”ç”¨å®ä¾‹å…¥å£ï¼ŒåŸºç¡€è·¯ç”±å’Œä¸­é—´ä»¶
â”‚   â”œâ”€â”€ models.py                    # API è¯·æ±‚/å“åº”æ¨¡å‹
â”‚   â””â”€â”€ routers/                     # è·¯ç”±æ¨¡å—ç›®å½•ï¼ŒæŒ‰åŠŸèƒ½æ‹†åˆ†çš„è·¯ç”±å®šä¹‰
â”‚       â”œâ”€â”€ ticker.py               # è‚¡ç¥¨ç›¸å…³è·¯ç”±ï¼ˆåˆ†é¡µæŸ¥è¯¢ã€è¯¦æƒ…ã€æ‰¹é‡æ›´æ–°ï¼‰
â”‚       â”œâ”€â”€ news.py                 # æ–°é—»ç›¸å…³è·¯ç”±ï¼ˆæ–‡ç« æŸ¥è¯¢ã€æ–°é—»æºç®¡ç†ï¼‰
â”‚       â””â”€â”€ scheduler.py            # è°ƒåº¦å™¨ç›¸å…³è·¯ç”±ï¼ˆå®šæ—¶ä»»åŠ¡ã€æŠ“å–ç®¡ç†ï¼‰
â”œâ”€â”€ core/                            # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ models/                      # æ•°æ®åº“æ¨¡å‹å±‚ (SQLAlchemy)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ api_log.py              # APIæ—¥å¿—æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ ticker.py               # è‚¡ç¥¨åŸºç¡€ä¿¡æ¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ ticker_indicator.py     # è‚¡ç¥¨æŠ€æœ¯æŒ‡æ ‡æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ ticker_score.py         # è‚¡ç¥¨è¯„åˆ†æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ ticker_strategy.py      # æŠ•èµ„ç­–ç•¥æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ ticker_valuation.py     # è‚¡ç¥¨ä¼°å€¼æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ news_source.py          # æ–°é—»æºé…ç½®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ news_article.py         # æ–°é—»æ–‡ç« æ¨¡å‹
â”‚   â”œâ”€â”€ service/                     # æ•°æ®è®¿é—®å±‚ (Repository Pattern)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ ticker_repository.py    # è‚¡ç¥¨æ•°æ®ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ ticker_indicator_repository.py
â”‚   â”‚   â”œâ”€â”€ ticker_score_repository.py
â”‚   â”‚   â”œâ”€â”€ ticker_strategy_repository.py
â”‚   â”‚   â”œâ”€â”€ ticker_valuation_repository.py
â”‚   â”‚   â””â”€â”€ api_log_repository.py
â”‚   â”œâ”€â”€ handler/                     # ä¸šåŠ¡å¤„ç†å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ ticker_handler.py       # è‚¡ç¥¨æ•°æ®å¤„ç†
â”‚   â”‚   â”œâ”€â”€ ticker_analysis_handler.py # è‚¡ç¥¨åˆ†æå¤„ç†
â”‚   â”‚   â”œâ”€â”€ ticker_score_handler.py
â”‚   â”‚   â”œâ”€â”€ ticker_strategy_handler.py
â”‚   â”‚   â”œâ”€â”€ ticker_valuation_handler.py
â”‚   â”‚   â”œâ”€â”€ ticker_indicator_handler.py
â”‚   â”‚   â”œâ”€â”€ ticker_k_line_handler.py
â”‚   â”‚   â””â”€â”€ ticker_filter_handler.py
â”‚   â”œâ”€â”€ data_providers/              # ğŸ†• ç»Ÿä¸€è‚¡ç¥¨æ•°æ®æä¾›è€…å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ stock_data_provider.py  # ç»Ÿä¸€æ•°æ®æä¾›è€…æŠ½è±¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ akshare_provider.py     # AKShareæ•°æ®æä¾›è€… (ä¼˜å…ˆçº§æœ€é«˜)
â”‚   â”‚   â”œâ”€â”€ xueqiu_provider.py      # é›ªçƒæ•°æ®æä¾›è€… (è¡¥å……æ•°æ®æº)
â”‚   â”‚   â””â”€â”€ stock_data_factory.py   # ç­–ç•¥æ¨¡å¼æ•°æ®æºå·¥å‚
â”‚   â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°å±‚
â”‚   â”‚   â”œâ”€â”€ xueqiu/                 # ğŸ†• é›ªçƒæ•°æ®è®¿é—®æŠ½è±¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ xueqiu_base_client.py    # é›ªçƒåŸºç¡€å®¢æˆ·ç«¯æŠ½è±¡ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ xueqiu_news_client.py    # é›ªçƒæ–°é—»å®¢æˆ·ç«¯ (ç»§æ‰¿åŸºç±»)
â”‚   â”‚   â”‚   â”œâ”€â”€ xueqiu_stock_client.py   # é›ªçƒè‚¡ç¥¨å®¢æˆ·ç«¯ (ç»§æ‰¿åŸºç±»)
â”‚   â”‚   â”‚   â”œâ”€â”€ xueqiu_client_factory.py # é›ªçƒå®¢æˆ·ç«¯å·¥å‚
â”‚   â”‚   â”‚   â”œâ”€â”€ xueqiu_api.py           # ğŸ”„ é‡æ„åçš„é›ªçƒAPI (ä½¿ç”¨æŠ½è±¡å±‚)
â”‚   â”‚   â”‚   â”œâ”€â”€ xueqiu_company.py       # é›ªçƒå…¬å¸ä¿¡æ¯æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ xueqiu_stock_quote.py   # é›ªçƒè‚¡ç¥¨æŠ¥ä»·æ¨¡å‹
â”‚   â”‚   â””â”€â”€ ...                     # å…¶ä»–å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ news_aggregator/             # æ–°é—»èšåˆæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ rss_aggregator.py       # RSSæ–°é—»èšåˆå™¨
â”‚   â”‚   â”œâ”€â”€ xueqiu_aggregator.py    # ğŸ”„ é‡æ„åçš„é›ªçƒèšåˆå™¨ (ä½¿ç”¨æŠ½è±¡å±‚)
â”‚   â”‚   â””â”€â”€ news_aggregator_manager.py
â”‚   â”œâ”€â”€ ai_agents/                   # AIä»£ç†æ¨¡å— (æ–°å¢)
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ nlp_utils/                   # NLPå·¥å…·æ¨¡å— (æ–°å¢)
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ opportunity_detector/        # æŠ•èµ„æœºä¼šæ£€æµ‹æ¨¡å— (æ–°å¢)
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ quantitative_analyzer/       # é‡åŒ–åˆ†ææ¨¡å— (æ–°å¢)
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ database/                    # æ•°æ®åº“æ“ä½œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ db_adapter.py           # æ•°æ®åº“é€‚é…å™¨ (MySQL/PostgreSQL/SQLite)
â”‚   â”‚   â””â”€â”€ news_db_init.py         # æ–°é—»æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ auth/                        # è®¤è¯æˆæƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth_middleware.py      # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ auth_grpc_client.py     # gRPCè®¤è¯å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ grpc/                        # gRPCç›¸å…³
â”‚   â”‚   â””â”€â”€ auth/                   # è®¤è¯æœåŠ¡Protoå®šä¹‰
â”‚   â”œâ”€â”€ analysis/                    # è‚¡ç¥¨åˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ strategy/                    # æŠ•èµ„ç­–ç•¥æ¨¡å—
â”‚   â”œâ”€â”€ indicator/                   # æŠ€æœ¯æŒ‡æ ‡æ¨¡å—
â”‚   â”œâ”€â”€ valuation/                   # ä¼°å€¼æ¨¡å—
â”‚   â”œâ”€â”€ score/                       # è¯„åˆ†æ¨¡å—
â”‚   â”œâ”€â”€ filter/                      # ç­›é€‰æ¨¡å—
â”‚   â”œâ”€â”€ schema/                      # æ•°æ®Schemaå®šä¹‰
â”‚   â”œâ”€â”€ enum/                        # æšä¸¾å®šä¹‰
â”‚   â””â”€â”€ data_source_helper.py        # æ•°æ®æºè¾…åŠ©ç±»
â”œâ”€â”€ workers/                         # å¼‚æ­¥ä»»åŠ¡å·¥ä½œè¿›ç¨‹ (æ–°å¢)
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ scripts/                         # å¼€å‘è¿è¡Œè„šæœ¬
â”œâ”€â”€ tests/                           # æµ‹è¯•ä»£ç 
â”œâ”€â”€ proto/                           # Protobufå®šä¹‰æ–‡ä»¶
â”œâ”€â”€ sql/                           # SQLè„šæœ¬
â”œâ”€â”€ memory-bank/                   # Memory Bankç³»ç»Ÿ
â”œâ”€â”€ invest_note.py                 # CLIå·¥å…·å…¥å£
â”œâ”€â”€ requirements.txt               # Pythonä¾èµ–
â”œâ”€â”€ .env                           # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ docker-compose.yaml            # Dockerç¼–æ’é…ç½®
â”œâ”€â”€ Dockerfile                     # Dockeré•œåƒé…ç½®
â””â”€â”€ README.md                      # é¡¹ç›®è¯´æ˜

```

### **æ•°æ®æä¾›è€…å±‚** (`core/data_providers/`)

InvestNote-pyé‡‡ç”¨ç»Ÿä¸€çš„æ•°æ®æä¾›è€…æ¶æ„ï¼Œå®ç°å¤šæ•°æ®æºæ™ºèƒ½ç®¡ç†ï¼š

#### 1. **ç»Ÿä¸€æŠ½è±¡æ¥å£** 
- **[stock_data_provider.py](mdc:core/data_providers/stock_data_provider.py)**: å®šä¹‰æ ‡å‡†åŒ–è‚¡ç¥¨æ•°æ®è®¿é—®æ¥å£
- æ”¯æŒå¤šå¸‚åœºï¼ˆAè‚¡ã€æ¸¯è‚¡ã€ç¾è‚¡ã€è‹±è‚¡ï¼‰
- ç»Ÿä¸€çš„æ•°æ®å‘¨æœŸå’Œé”™è¯¯å¤„ç†
- ä¼˜å…ˆçº§ç®¡ç†å’Œè‡ªåŠ¨é™çº§æœºåˆ¶

#### 2. **AKShareæ•°æ®æä¾›è€…** (ä¼˜å…ˆçº§: 100)
- **[akshare_provider.py](mdc:core/data_providers/akshare_provider.py)**: åŸºäºakshareåº“çš„ä¸»è¦æ•°æ®æº
- è¦†ç›–è‚¡ç¥¨ä¿¡æ¯ã€å®æ—¶è¡Œæƒ…ã€å†å²æ•°æ®ã€å…¬å¸ä¿¡æ¯ã€è‚¡ç¥¨æœç´¢
- è‡ªåŠ¨å¸‚åœºæ£€æµ‹å’Œè‚¡ç¥¨ä»£ç æ ‡å‡†åŒ–
- å®Œæ•´çš„Aè‚¡ã€æ¸¯è‚¡ã€ç¾è‚¡æ”¯æŒ
- ç›¸å…³æ–‡æ¡£é€šè¿‡ mcp context7æŸ¥è¯¢

#### 3. **é›ªçƒæ•°æ®æä¾›è€…** (ä¼˜å…ˆçº§: 50)  
- **[xueqiu_provider.py](mdc:core/data_providers/xueqiu_provider.py)**: ä½œä¸ºAKShareçš„è¡¥å……æ•°æ®æº
- ä½¿ç”¨é‡æ„åçš„é›ªçƒå®¢æˆ·ç«¯æŠ½è±¡å±‚
- æä¾›åŒæ­¥å’Œå¼‚æ­¥æ“ä½œæ¥å£

#### 4. **ç­–ç•¥å·¥å‚ç®¡ç†**
- **[stock_data_factory.py](mdc:core/data_providers/stock_data_factory.py)**: å®ç°ç­–ç•¥æ¨¡å¼
- æ™ºèƒ½æ•°æ®æºé€‰æ‹©å’Œè‡ªåŠ¨é™çº§
- é”™è¯¯è®¡æ•°å’Œå¯ç”¨æ€§ç›‘æ§
- å…¨å±€å·¥å‚å®ä¾‹å’Œä¾¿æ·å‡½æ•°

### **é›ªçƒæ•°æ®æŠ½è±¡å±‚** (`core/utils/xueqiu/`)

å®Œå…¨é‡æ„çš„é›ªçƒæ•°æ®è®¿é—®å±‚ï¼Œæ¶ˆé™¤ä»£ç é‡å¤ï¼Œå®ç°èŒè´£åˆ†ç¦»ï¼š

#### 1. **åŸºç¡€æŠ½è±¡å®¢æˆ·ç«¯**
- **[xueqiu_base_client.py](mdc:core/utils/xueqiu/xueqiu_base_client.py)**: ç»Ÿä¸€çš„åŸºç¡€å®¢æˆ·ç«¯
- ä¼šè¯ç®¡ç†ã€ä»¤ç‰Œè·å–ï¼ˆpyppeteer + urllibå¤‡ç”¨ï¼‰ã€HTTPè¯·æ±‚å°è£…
- åŒæ­¥/å¼‚æ­¥æ¥å£ã€é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

#### 2. **ä¸“ä¸šåŒ–å®¢æˆ·ç«¯**
- **[xueqiu_news_client.py](mdc:core/utils/xueqiu/xueqiu_news_client.py)**: æ–°é—»èšåˆä¸“ç”¨å®¢æˆ·ç«¯
  - ç»§æ‰¿åŸºç¡€å®¢æˆ·ç«¯ï¼Œä¸“æ³¨æ–°é—»æ—¶é—´çº¿æ•°æ®
  - è‚¡ç¥¨ç¬¦å·æå–ã€é‡è¦æ€§è¯„åˆ†ã€å†…å®¹è¿‡æ»¤
- **[xueqiu_stock_client.py](mdc:core/utils/xueqiu/xueqiu_stock_client.py)**: è‚¡ç¥¨æ•°æ®ä¸“ç”¨å®¢æˆ·ç«¯
  - ç»§æ‰¿åŸºç¡€å®¢æˆ·ç«¯ï¼Œä¸“æ³¨è‚¡ç¥¨è¡Œæƒ…å’Œå…¬å¸ä¿¡æ¯
  - æ”¯æŒAè‚¡ï¼ˆSH/SZï¼‰ã€æ¸¯è‚¡ï¼ˆHKï¼‰ã€ç¾è‚¡å¤šå¸‚åœº

#### 3. **å®¢æˆ·ç«¯å·¥å‚**
- **[xueqiu_client_factory.py](mdc:core/utils/xueqiu/xueqiu_client_factory.py)**: ç»Ÿä¸€å®¢æˆ·ç«¯åˆ›å»ºå’Œç®¡ç†
- é…ç½®å…±äº«ã€ä¼šè¯ç®¡ç†ã€ç±»å‹å®‰å…¨çš„å®¢æˆ·ç«¯åˆ›å»º

## æ¶æ„å±‚æ¬¡è¯´æ˜

### 1. **API å±‚** (`api/`)
- **[api.py](mdc:api/api.py)**: FastAPIåº”ç”¨å®ä¾‹å…¥å£ï¼ŒåŸºç¡€è·¯ç”±å’Œä¸­é—´ä»¶ï¼Œè·¯ç”±æ¨¡å—æ³¨å†Œ
- **[models.py](mdc:api/models.py)**: APIè¯·æ±‚å’Œå“åº”çš„Pydanticæ¨¡å‹å®šä¹‰
- **[routers/](mdc:api/routers)**: è·¯ç”±æ¨¡å—ç›®å½•ï¼ŒæŒ‰åŠŸèƒ½æ‹†åˆ†çš„è·¯ç”±å®šä¹‰
  - **[ticker.py](mdc:api/routers/ticker.py)**: è‚¡ç¥¨ç›¸å…³è·¯ç”±ï¼ˆåˆ†é¡µæŸ¥è¯¢ã€è¯¦æƒ…ã€æ‰¹é‡æ›´æ–°ï¼‰
  - **[news.py](mdc:api/routers/news.py)**: æ–°é—»ç›¸å…³è·¯ç”±ï¼ˆæ–‡ç« æŸ¥è¯¢ã€æ–°é—»æºç®¡ç†ï¼‰
  - **[scheduler.py](mdc:api/routers/scheduler.py)**: è°ƒåº¦å™¨ç›¸å…³è·¯ç”±ï¼ˆå®šæ—¶ä»»åŠ¡ã€æŠ“å–ç®¡ç†ï¼‰
- **ç‰¹ç‚¹**: æ¨¡å—åŒ–è·¯ç”±è®¾è®¡ï¼ŒèŒè´£åˆ†ç¦»ï¼Œå‘åå…¼å®¹çš„APIç«¯ç‚¹

### 2. **æ ¸å¿ƒä¸šåŠ¡å±‚** (`core/`)

#### 2.1 **æ•°æ®æ¨¡å‹å±‚** (`core/models/`)
- ä½¿ç”¨SQLAlchemyå®šä¹‰æ‰€æœ‰æ•°æ®åº“è¡¨ç»“æ„
- æŒ‰ä¸šåŠ¡é¢†åŸŸç»„ç»‡ï¼šè‚¡ç¥¨ã€æ–°é—»ã€ç”¨æˆ·ã€æ—¥å¿—ç­‰
- åŒ…å«æ•°æ®æ¨¡å‹çš„å±æ€§è®¿é—®å™¨å’Œä¸šåŠ¡æ–¹æ³•

#### 2.2 **æ•°æ®è®¿é—®å±‚** (`core/service/`)
- å®ç°Repositoryæ¨¡å¼ï¼Œå°è£…æ•°æ®åº“æ“ä½œ
- æ¯ä¸ªä¸»è¦å®ä½“å¯¹åº”ä¸€ä¸ªRepositoryç±»
- æä¾›CRUDæ“ä½œå’Œå¤æ‚æŸ¥è¯¢æ–¹æ³•
- ä¸SQLAlchemy ORMäº¤äº’

#### 2.3 **ä¸šåŠ¡å¤„ç†å±‚** (`core/handler/`)
- å°è£…ç‰¹å®šé¢†åŸŸçš„ä¸šåŠ¡é€»è¾‘
- åè°ƒå¤šä¸ªRepositoryè¿›è¡Œå¤æ‚ä¸šåŠ¡æ“ä½œ
- å¤„ç†æ•°æ®è½¬æ¢å’Œä¸šåŠ¡è§„åˆ™éªŒè¯
- è¢«APIå±‚è°ƒç”¨æ‰§è¡Œå…·ä½“ä¸šåŠ¡åŠŸèƒ½

#### 2.4 **ğŸ†• æ•°æ®æä¾›è€…å±‚** (`core/data_providers/`)
- ç»Ÿä¸€çš„è‚¡ç¥¨æ•°æ®è®¿é—®æŠ½è±¡å±‚
- ç­–ç•¥æ¨¡å¼ç®¡ç†å¤šæ•°æ®æºï¼ˆAKShareä¼˜å…ˆï¼Œé›ªçƒè¡¥å……ï¼‰
- æ™ºèƒ½é™çº§å’Œé”™è¯¯å¤„ç†
- æ”¯æŒå¤šå¸‚åœºè‚¡ç¥¨æ•°æ®è·å–

#### 2.5 **æ–°å¢AI/æ–°é—»æ¨¡å—**
- **`news_aggregator/`**: æ–°é—»æ•°æ®æŠ“å–å’Œå¤„ç†ï¼ˆå·²é›†æˆé›ªçƒæŠ½è±¡å±‚ï¼‰
- **`ai_agents/`**: AIä»£ç†æ¡†æ¶ï¼Œå¤šAgentåä½œåˆ†æ
- **`nlp_utils/`**: è‡ªç„¶è¯­è¨€å¤„ç†å·¥å…·
- **`opportunity_detector/`**: æŠ•èµ„æœºä¼šè¯†åˆ«ç®—æ³•
- **`quantitative_analyzer/`**: é‡åŒ–åˆ†æå·¥å…·

### 3. **æ”¯æ’‘ç³»ç»Ÿ**

#### 3.1 **è®¤è¯ç³»ç»Ÿ** (`core/auth/`)
- gRPCå®¢æˆ·ç«¯è¿æ¥å¤–éƒ¨è®¤è¯æœåŠ¡
- ä¸­é—´ä»¶å®ç°è¯·æ±‚è®¤è¯å’Œæˆæƒ
- æ”¯æŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

#### 3.2 **ä»»åŠ¡é˜Ÿåˆ—** (`workers/`)
- Celeryå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ
- å¤„ç†è€—æ—¶çš„æ•°æ®åˆ†æå’Œæ–°é—»å¤„ç†ä»»åŠ¡

#### 3.3 **Memory Bankç³»ç»Ÿ** (`memory-bank/`)
- é¡¹ç›®ä¸Šä¸‹æ–‡ç®¡ç†
- å¼€å‘è¿›åº¦è·Ÿè¸ª
- æŠ€æœ¯æ–‡æ¡£ç»´æŠ¤

## ğŸ†• æ•°æ®æµè½¬æ¨¡å¼ (æ›´æ–°)

### HTTP APIæ•°æ®æµ
```
HTTPè¯·æ±‚ â†’ api.py â†’ Handler â†’ Repository â†’ SQLAlchemy â†’ æ•°æ®åº“
          â†“
     PydanticéªŒè¯ â†’ ä¸šåŠ¡é€»è¾‘å¤„ç† â†’ æ•°æ®æŒä¹…åŒ– â†’ HTTPå“åº”
```

### è‚¡ç¥¨æ•°æ®è·å–æµ
```
ä¸šåŠ¡è¯·æ±‚ â†’ StockDataFactory â†’ æ•°æ®æºé€‰æ‹© â†’ AKShare/é›ªçƒProvider â†’ æ•°æ®æ ‡å‡†åŒ– â†’ ä¸šåŠ¡è¿”å›
                â†“
         æ™ºèƒ½é™çº§ç­–ç•¥ â†’ é”™è¯¯è®¡æ•° â†’ è‡ªåŠ¨åˆ‡æ¢ â†’ å¯ç”¨æ€§ç›‘æ§
```

### é›ªçƒæ•°æ®è®¿é—®æµ
```
ä¸šåŠ¡è¯·æ±‚ â†’ XueqiuClientFactory â†’ å®¢æˆ·ç«¯é€‰æ‹© â†’ XueqiuBaseClient â†’ ä»¤ç‰Œç®¡ç† â†’ HTTPè¯·æ±‚
                â†“                     â†“
         NewsClient/StockClient â†’ ä¸“ä¸šåŒ–å¤„ç† â†’ æ•°æ®è§£æ â†’ ç»“æ„åŒ–è¿”å›
```

## å‘½åçº¦å®š

### æ–‡ä»¶å‘½å
- **æ¨¡å‹æ–‡ä»¶**: `{entity}.py` (å¦‚ `ticker.py`, `news_article.py`)
- **Repositoryæ–‡ä»¶**: `{entity}_repository.py` (å¦‚ `ticker_repository.py`)
- **Handleræ–‡ä»¶**: `{entity}_{function}_handler.py` (å¦‚ `ticker_analysis_handler.py`)
- **ğŸ†• Provideræ–‡ä»¶**: `{source}_provider.py` (å¦‚ `akshare_provider.py`)
- **ğŸ†• Clientæ–‡ä»¶**: `{source}_{type}_client.py` (å¦‚ `xueqiu_stock_client.py`)

### ç±»å‘½å
- **æ•°æ®æ¨¡å‹**: `{Entity}` (å¦‚ `Ticker`, `NewsArticle`)
- **Repositoryç±»**: `{Entity}Repository` (å¦‚ `TickerRepository`)
- **Handlerç±»**: `{Entity}{Function}Handler` (å¦‚ `TickerAnalysisHandler`)
- **ğŸ†• Providerç±»**: `{Source}Provider` (å¦‚ `AKShareProvider`)
- **ğŸ†• Clientç±»**: `{Source}{Type}Client` (å¦‚ `XueqiuNewsClient`)

### æ–¹æ³•å‘½å
- **Repositoryæ–¹æ³•**: `get_`, `create_`, `update_`, `delete_`, `find_by_`
- **Handleræ–¹æ³•**: åæ˜ å…·ä½“ä¸šåŠ¡æ“ä½œï¼Œå¦‚ `calculate_score`, `analyze_trend`
- **ğŸ†• Provideræ–¹æ³•**: `get_stock_info`, `get_stock_quote`, `get_stock_history`, `search_stocks`
- **ğŸ†• Routeræ–¹æ³•**: ä½¿ç”¨HTTPåŠ¨è¯å‰ç¼€ï¼Œå¦‚ `get_`, `post_`, `put_`, `delete_`

## æ¨¡å—ä¾èµ–å…³ç³»

- **APIè·¯ç”±æ¨¡å—** â†’ **Handlerå±‚** â†’ **Repositoryå±‚** â†’ **Modelå±‚**
- **APIä¸»åº”ç”¨** â†’ **è·¯ç”±æ¨¡å—æ³¨å†Œ** â†’ **ä¸­é—´ä»¶å¤„ç†** â†’ **å¼‚å¸¸è®°å½•**
- **Handlerå±‚** â†’ **DataProviderå±‚** â†’ **ExternalAPIå±‚**
- **DataProviderå±‚** â†’ **é›ªçƒæŠ½è±¡å±‚** â†’ **é›ªçƒåŸºç¡€å®¢æˆ·ç«¯**
- **æ–°é—»æ¨¡å—** â†’ **AIä»£ç†** â†’ **NLPå·¥å…·** â†’ **æœºä¼šæ£€æµ‹**
- **è®¤è¯æ¨¡å—** ä¸ºæ‰€æœ‰å±‚æä¾›æ¨ªåˆ‡å…³æ³¨ç‚¹
- **Memory Bank** ç‹¬ç«‹ç»´æŠ¤é¡¹ç›®ä¸Šä¸‹æ–‡

## APIæ¨¡å—åŒ–å»ºè®®

- **è·¯ç”±æ‹†åˆ†**: æŒ‰ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†è·¯ç”±æ¨¡å—ï¼Œä¿æŒå•ä¸€èŒè´£
- **å‘åå…¼å®¹**: æ‹†åˆ†æ—¶ä¿æŒAPIç«¯ç‚¹è·¯å¾„ä¸å˜
- **å…±äº«ä¾èµ–**: é€šè¿‡ä¾èµ–æ³¨å…¥å…±äº«Repositoryå’ŒHandlerå®ä¾‹
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•æœºåˆ¶
- **æ–‡æ¡£æ ‡ç­¾**: ä½¿ç”¨FastAPI tagsç»„ç»‡APIæ–‡æ¡£ç»“æ„
- **æ¨¡å—å¯¼å…¥**: æ–°è·¯ç”±æ¨¡å—éœ€åœ¨ä¸»åº”ç”¨ä¸­æ³¨å†Œ
